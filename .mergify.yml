# Mergify Configuration
# Documentation: https://docs.mergify.com/

pull_request_rules:
  # üìù Fast-track auto-merge for docs & dev-only changes
  - name: Auto-merge docs & dev-only PRs
    conditions:
      - files~=^(.*\.md|LICENSE|\.github/(ISSUE_TEMPLATE/.*|PULL_REQUEST_TEMPLATE\.md)|supabase/.*)$
      - check-success=Documentation & Dev Files Check
      - '#approved-reviews-by>=1'
      - -draft
    actions:
      merge:
        method: squash
      delete_head_branch: {}
      comment:
        message: |
          ‚úÖ Auto-merged by Mergify (docs/dev-only change)
          üìù Only documentation or local dev files (supabase/) modified - skipped heavy checks for efficiency

  # ‚öôÔ∏è Fast-track auto-merge for config-only changes
  - name: Auto-merge config-only PRs
    conditions:
      - files~=^(\.mergify\.yml|\.github/dependabot\.yml|\.prettierrc.*|\.prettierignore|eslint\.config\..*|\.eslintrc.*|\.eslintignore|tailwind\.config\..*|postcss\.config\..*|\.husky/.*|\.gitignore|\.gitattributes|\.mcp\.json.*|.*\.example)$
      - check-success=Configuration Check
      - '#approved-reviews-by>=1'
      - -draft
    actions:
      merge:
        method: squash
      delete_head_branch: {}
      comment:
        message: |
          ‚úÖ Auto-merged by Mergify (config-only change)
          ‚öôÔ∏è Only configuration files modified - skipped tests & build for efficiency

  # ü§ñ Auto-merge for Dependabot PRs
  - name: Auto-merge Dependabot PRs when CI passes
    conditions:
      - author=dependabot[bot]
      - check-success=TypeScript Check
      - check-success=Lint Code
      - check-success=Check Formatting
      - check-success=Tests & Coverage
      - check-success=Build Application
      - '#approved-reviews-by>=1'
    actions:
      merge:
        method: squash
      delete_head_branch: {}
      comment:
        message: |
          ‚úÖ Auto-merged by Mergify
          All checks passed, Dependabot PR has been automatically merged.

  # üè∑Ô∏è Auto-merge for PRs with 'automerge' label
  - name: Auto-merge PRs with automerge label
    conditions:
      - label=automerge
      - check-success=TypeScript Check
      - check-success=Lint Code
      - check-success=Check Formatting
      - check-success=Tests & Coverage
      - check-success=Build Application
      - '#approved-reviews-by>=1'
      - -draft
    actions:
      merge:
        method: squash
      delete_head_branch: {}
      comment:
        message: |
          ‚úÖ Auto-merged by Mergify
          All checks passed. Auto-merging with automerge label.

  # üè∑Ô∏è Auto-label Dependabot PRs
  - name: Label Dependabot PRs
    conditions:
      - author=dependabot[bot]
    actions:
      label:
        add:
          - dependencies
          - automated

  # üêõ Auto-label by PR title prefix
  - name: Label bug fixes
    conditions:
      - 'title~=^fix'
    actions:
      label:
        add:
          - bug

  - name: Label features
    conditions:
      - 'title~=^feat'
    actions:
      label:
        add:
          - enhancement

  - name: Label documentation
    conditions:
      - 'title~=^docs'
    actions:
      label:
        add:
          - documentation

  - name: Label refactoring
    conditions:
      - 'title~=^refactor'
    actions:
      label:
        add:
          - refactoring

  - name: Label tests
    conditions:
      - 'title~=^test'
    actions:
      label:
        add:
          - tests

  # üìù Auto-label docs & dev-only PRs
  - name: Label docs & dev-only changes
    conditions:
      - files~=^(.*\.md|LICENSE|\.github/(ISSUE_TEMPLATE/.*|PULL_REQUEST_TEMPLATE\.md)|supabase/.*)$
      - -files~=^(?!.*\.md|LICENSE|\.github/(ISSUE_TEMPLATE/.*|PULL_REQUEST_TEMPLATE\.md)|supabase/.*).*$
    actions:
      label:
        add:
          - documentation
          - skip-ci-heavy
      comment:
        message: |
          üìù This PR only modifies documentation or local dev files
          üóÇÔ∏è Changed: docs, supabase (local dev setup), or other non-production files
          ‚ö° Heavy CI checks (typecheck, tests, build) will be skipped to save resources

  # ‚öôÔ∏è Auto-label config-only PRs
  - name: Label config-only changes
    conditions:
      - files~=^(\.mergify\.yml|\.github/dependabot\.yml|\.prettierrc.*|\.prettierignore|eslint\.config\..*|\.eslintrc.*|\.eslintignore|tailwind\.config\..*|postcss\.config\..*|\.husky/.*|\.gitignore|\.gitattributes|\.mcp\.json.*|.*\.example)$
      - -files~=^(?!\.mergify\.yml|\.github/dependabot\.yml|\.prettierrc.*|\.prettierignore|eslint\.config\..*|\.eslintrc.*|\.eslintignore|tailwind\.config\..*|postcss\.config\..*|\.husky/.*|\.gitignore|\.gitattributes|\.mcp\.json.*|.*\.example).*$
    actions:
      label:
        add:
          - configuration
          - skip-ci-partial
      comment:
        message: |
          ‚öôÔ∏è This PR only modifies configuration files
          ‚ö° Heavy CI checks (typecheck, tests, build) will be skipped to save resources
          üìã Only lint + format check will run
